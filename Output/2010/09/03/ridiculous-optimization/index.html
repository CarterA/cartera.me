<!DOCTYPE HTML>
<!--
	Well hello there! Feel free to look over the code here, if you'd like.
	It is worth mentioning that the un-compiled version of the site's code
	can be found here:  http://github.com/CarterA/cartera.me/
-->
<html>
	<head>
		
		<meta charset="utf-8">
		<title>Carter Allen - Ridiculous Optimization</title>
		<meta name="description" content="Articles and projects written and created by developer Carter Allen.">
		<meta name="author" content="Carter Allen">
		<link rel="alternate" type="application/atom+xml" title="Carter Allen - Feed" href="http://feeds.feedburner.com/CarterADotMeBlog?format=xml">
		<link rel="openid.server" href="http://www.myopenid.com/server" />
		<link rel="openid.delegate" href="http://carterallen.myopenid.com/" />
		<link rel="openid2.local_id" href="http://carterallen.myopenid.com" />
		<link rel="openid2.provider" href="http://www.myopenid.com/server" />
		
		<meta name="viewport" content="width=device-width">
		<link rel="stylesheet" href="/stylesheets/main.css">
		
        
		<link rel="stylesheet" href="/stylesheets/post.css">
		
		
	</head>
	<body>
	    <div id="container">
		<header>
		    <div class="badtie"></div>
			<a href="/">
				<img id="logo" src="/images/hat.png" width=190 height=100>
				<p id="logotype">carter<b>allen</b></p>
			</a>
			<nav>
			  <ul>
				<li><a href="/">Articles</a></li>
				<li><a href="/projects">Projects</a></li>
				<li><a href="/archives">Archives</a></li>
				<li><a href="/about/" rel="author">About</a></li>
			  </ul>
			</nav>
		</header>
		<section id ="content"><!-- Stylesheets: post -->
<article class="post">
	<header class="post-header">
		<h1>Ridiculous Optimization</h1>
		<span class="date">Sep 3, 2010</span>
	</header>
	<section class="post-content">
		<p>The latest project I&#39;ve been working on with regards to this website is optimizing its load time. At first it was simple, obvious things: enable GZip compression on the server, minify CSS and JS, you know:  standard optimization. After that was done, the index page of my site weighed in at about <strong>21.7kb</strong>. Quite lightweight, but that wasn&#39;t good enough. So I started on the next step:  ridiculous optimization.  </p>

<p>The first bit of ridiculous optimization is extremely heavy caching of all static files. That may not seem ridiculous, but when the files we&#39;re talking about are around a kilobyte or less each, it&#39;s quite a bit of trouble for such a minute gain. The issue with caching is, of course, that you need to have some way of invalidating the cached copies if you change something, otherwise they&#39;ll never get updated on user&#39;s machines. The fix I&#39;m using for this problem is query parameters (like &quot;?revision=whatever&quot; on the end of the URL). When the links are generated for my static files, it appends &quot;?revision=&quot; and the most recent commit hash <em>that affects the file</em>. That last bit there is important:  it means that even when I change something else on my site and move to a newer commit hash, the files that are still unchanged remain cached. I accomplish this bit of magic with a Jekyll plugin (place in a .rb file in a _plugins directory in your site folder):  </p>

<p><a href="http://github.com/CarterA/cartera.me/blob/master/_plugins/VersionControlledFiles.rb">View VersionControlledFiles.rb on GitHub.</a>  </p>

<p>The second bit of optimization was to get rid of <a href="http://modernizr.com/">Modernizr</a>. I know what you&#39;re thinking:  <em>but Carter, your site uses HTML5 and you need Modernizr to enable HTML5 for older browsers, right?</em>. Wrong. I don&#39;t deny that it is an excellent and useful library, but what makes it so big is that it doesn&#39;t just enable all sorts of features, it also lets you know which ones are supported. It&#39;s the second part that takes a ton of code. I am now using a tiny script that I&#39;ve had saved in my snippets for a long time (I didn&#39;t write it, so if you recognize the source, let me know!):  </p>

<script src="https://gist.github.com/1257903.js"></script>

<p>This simply adds each of the new HTML5 elements to the DOM so that IE and older versions of Firefox can style those elements correctly. Best part is, <em>it&#39;s tiny</em>!  </p>

<p>One more thing:  I mentioned early on that I minified CSS. Now, working with minified CSS is a gigantic pain in the ass, so I wrote another Jekyll plugin to do that:  </p>

<p><a href="http://github.com/CarterA/cartera.me/blob/master/_plugins/Minifier.rb">View Minifier.rb on GitHub.</a>  </p>

<p>After all of this, my site now weighs in at about <strong>12.2kb</strong>, and around <strong>6kb</strong> once it has everything cached. Happy optimizing!</p>

	</section>
	<section class="comments">
		<div id="disqus_thread"></div>
		<script src="http://disqus.com/forums/cartera/embed.js"></script>
		<noscript><a href="http://cartera.disqus.com/?url=ref">View the discussion thread.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a>
	</section>
</article></section>
		<footer>
			<p>Site revision <a href="http://github.com/CarterA/cartera.me/tree/"></a>. Valid <a href="http://validator.w3.org/check?uri=referer" target="_blank">HTML5</a>.</p>
			<p>Copyright 2010 Carter Allen</p>
			<div class="badtie"></div>
		</footer>
		</div>
	</body>
</html>